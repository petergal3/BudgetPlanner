with saving_s as (select  sum(amount) as s, s.date as d from dbo.saving s where userId = 1 and  s.date between '2021-01-01' and '2022-01-13' group by s.date), transactions_s as ((select  sum(amount) as t1, userId, t.date as d from dbo.transactions t where userId = 1 and  type = 'income' and t.date between '2021-01-01' and '2022-01-13' group by t.date,userId)),transactions_e as (  (select  sum(amount) as e  , userId, t.date as d  from dbo.transactions t  where userId = 1 and  type = 'expense' and t.date between '2021-01-01' and '2022-01-13' group by t.date,userId))  select case when(select t0.t1 from transactions_s t0 where userId = 1 and  t0.d = (SELECT  TOP 1 t1.d   FROM transactions_s t1  where userId = 1 and  t1.d < s.d and t1.d is not null    ORDER BY t1.d desc)) is null and t.d is null then 0 when t.d is null then(select t0.t1 from transactions_s t0 where userId = 1 and  t0.d = (SELECT    TOP 1 t1.d    FROM transactions_s t1   where userId = 1 and  t1.d < s.d and t1.d is not null  ORDER BY t1.d desc)) else t.t1 end as in_amount  from transactions_s t full outer join transactions_e e on e.d =t.d full outer join saving_s s on s.d = t.d or s.d = e.d 